<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="870px" preserveAspectRatio="none" style="width:645px;height:870px;" version="1.1" viewBox="0 0 645 870" width="645px" zoomAndPan="magnify"><defs><filter height="300%" id="famtcswlmg5zb" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--cluster AI--><polygon fill="#FFFFFF" filter="url(#famtcswlmg5zb)" points="317,539,338,539,345,561.2969,610,561.2969,610,858,317,858,317,539" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="317" x2="345" y1="561.2969" y2="561.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="15" x="321" y="553.9951">AI</text><!--cluster Data--><polygon fill="#FFFFFF" filter="url(#famtcswlmg5zb)" points="22,24,63,24,70,46.2969,623,46.2969,623,506,22,506,22,24" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="22" x2="70" y1="46.2969" y2="46.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="35" x="26" y="38.9951">Data</text><!--class AI.Topic--><rect fill="#FFFFFF" filter="url(#famtcswlmg5zb)" height="73.6094" id="AI.Topic" style="stroke: #000000; stroke-width: 1.5;" width="101" x="492.5" y="580"/><ellipse cx="523.7" cy="596" fill="#ADD1B2" rx="11" ry="11" style="stroke: #000000; stroke-width: 1.0;"/><path d="M526.0438,591.6719 L526.2156,591.75 C526.4344,591.4375 526.6375,591.3438 526.9344,591.3438 C527.2313,591.3438 527.5125,591.4844 527.6688,591.75 C527.7625,591.9063 527.7781,592.0313 527.7781,592.4688 L527.7781,593.8906 C527.7781,594.3125 527.7469,594.5 527.6375,594.6563 C527.4656,594.875 527.2,595.0156 526.9344,595.0156 C526.7156,595.0156 526.4813,594.9063 526.3406,594.7656 C526.2,594.6406 526.1688,594.5156 526.1063,594.1094 C526.0125,593.7031 525.8406,593.4844 525.3563,593.2031 C524.8875,592.9531 524.2781,592.7969 523.7,592.7969 C521.9656,592.7969 520.7156,594.1094 520.7156,595.8906 L520.7156,596.9844 C520.7156,598.6875 522.0125,599.7813 524.0594,599.7813 C524.825,599.7813 525.5125,599.6563 525.9344,599.3906 C526.1219,599.2969 526.1219,599.2969 526.575,598.8125 C526.7625,598.625 526.9656,598.5469 527.1844,598.5469 C527.6531,598.5469 528.0438,598.9375 528.0438,599.3906 C528.0438,599.7813 527.7156,600.2344 527.1375,600.6406 C526.3875,601.1875 525.2313,601.4844 524.0125,601.4844 C521.1219,601.4844 519.0125,599.5938 519.0125,597.0156 L519.0125,595.8906 C519.0125,593.1719 521.0125,591.0938 523.6375,591.0938 C524.5125,591.0938 525.1063,591.2344 526.0438,591.6719 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="33" x="541.3" y="600.1543">Topic</text><line style="stroke: #000000; stroke-width: 1.5;" x1="493.5" x2="592.5" y1="612" y2="612"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="498.5" y="626.2104">name: str</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="89" x="498.5" y="639.0151">rules: List[Rule]</text><line style="stroke: #000000; stroke-width: 1.5;" x1="493.5" x2="592.5" y1="645.6094" y2="645.6094"/><!--class AI.Rule--><rect fill="#FFFFFF" filter="url(#famtcswlmg5zb)" height="86.4141" id="AI.Rule" style="stroke: #000000; stroke-width: 1.5;" width="91" x="333.5" y="574"/><ellipse cx="362.9" cy="590" fill="#ADD1B2" rx="11" ry="11" style="stroke: #000000; stroke-width: 1.0;"/><path d="M365.2438,585.6719 L365.4156,585.75 C365.6344,585.4375 365.8375,585.3438 366.1344,585.3438 C366.4313,585.3438 366.7125,585.4844 366.8688,585.75 C366.9625,585.9063 366.9781,586.0313 366.9781,586.4688 L366.9781,587.8906 C366.9781,588.3125 366.9469,588.5 366.8375,588.6563 C366.6656,588.875 366.4,589.0156 366.1344,589.0156 C365.9156,589.0156 365.6813,588.9063 365.5406,588.7656 C365.4,588.6406 365.3688,588.5156 365.3063,588.1094 C365.2125,587.7031 365.0406,587.4844 364.5563,587.2031 C364.0875,586.9531 363.4781,586.7969 362.9,586.7969 C361.1656,586.7969 359.9156,588.1094 359.9156,589.8906 L359.9156,590.9844 C359.9156,592.6875 361.2125,593.7813 363.2594,593.7813 C364.025,593.7813 364.7125,593.6563 365.1344,593.3906 C365.3219,593.2969 365.3219,593.2969 365.775,592.8125 C365.9625,592.625 366.1656,592.5469 366.3844,592.5469 C366.8531,592.5469 367.2438,592.9375 367.2438,593.3906 C367.2438,593.7813 366.9156,594.2344 366.3375,594.6406 C365.5875,595.1875 364.4313,595.4844 363.2125,595.4844 C360.3219,595.4844 358.2125,593.5938 358.2125,591.0156 L358.2125,589.8906 C358.2125,587.1719 360.2125,585.0938 362.8375,585.0938 C363.7125,585.0938 364.3063,585.2344 365.2438,585.6719 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="27" x="380.1" y="594.1543">Rule</text><line style="stroke: #000000; stroke-width: 1.5;" x1="334.5" x2="423.5" y1="606" y2="606"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="79" x="339.5" y="620.2104">condition: dict</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="54" x="339.5" y="633.0151">score: int</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="76" x="339.5" y="645.8198">action: Action</text><line style="stroke: #000000; stroke-width: 1.5;" x1="334.5" x2="423.5" y1="652.4141" y2="652.4141"/><!--class AI.Action--><rect fill="#808080" filter="url(#famtcswlmg5zb)" height="105.1563" id="AI.Action" style="stroke: #000000; stroke-width: 1.5;" width="131" x="333.5" y="737"/><ellipse cx="358.4" cy="755.9688" fill="#ADD1B2" rx="11" ry="11" style="stroke: #000000; stroke-width: 1.0;"/><path d="M360.7438,751.6406 L360.9156,751.7188 C361.1344,751.4063 361.3375,751.3125 361.6344,751.3125 C361.9313,751.3125 362.2125,751.4531 362.3688,751.7188 C362.4625,751.875 362.4781,752 362.4781,752.4375 L362.4781,753.8594 C362.4781,754.2813 362.4469,754.4688 362.3375,754.625 C362.1656,754.8438 361.9,754.9844 361.6344,754.9844 C361.4156,754.9844 361.1813,754.875 361.0406,754.7344 C360.9,754.6094 360.8688,754.4844 360.8063,754.0781 C360.7125,753.6719 360.5406,753.4531 360.0563,753.1719 C359.5875,752.9219 358.9781,752.7656 358.4,752.7656 C356.6656,752.7656 355.4156,754.0781 355.4156,755.8594 L355.4156,756.9531 C355.4156,758.6563 356.7125,759.75 358.7594,759.75 C359.525,759.75 360.2125,759.625 360.6344,759.3594 C360.8219,759.2656 360.8219,759.2656 361.275,758.7813 C361.4625,758.5938 361.6656,758.5156 361.8844,758.5156 C362.3531,758.5156 362.7438,758.9063 362.7438,759.3594 C362.7438,759.75 362.4156,760.2031 361.8375,760.6094 C361.0875,761.1563 359.9313,761.4531 358.7125,761.4531 C355.8219,761.4531 353.7125,759.5625 353.7125,756.9844 L353.7125,755.8594 C353.7125,753.1406 355.7125,751.0625 358.3375,751.0625 C359.2125,751.0625 359.8063,751.2031 360.7438,751.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="81" x="372.6" y="753.1387">«Embedded»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="39" x="393.6" y="767.1074">Action</text><line style="stroke: #000000; stroke-width: 1.5;" x1="334.5" x2="463.5" y1="774.9375" y2="774.9375"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="73" x="339.5" y="789.1479">text: List[str]</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="117" x="339.5" y="801.9526">operations: List[dict]</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="93" x="339.5" y="814.7573">isQuestion: bool</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="119" x="339.5" y="827.562">immediatlyNext: bool</text><line style="stroke: #000000; stroke-width: 1.5;" x1="334.5" x2="463.5" y1="834.1563" y2="834.1563"/><!--class Data.User--><rect fill="#FFFFFF" filter="url(#famtcswlmg5zb)" height="73.6094" id="Data.User" style="stroke: #000000; stroke-width: 1.5;" width="141" x="38.5" y="74.5"/><ellipse cx="90.25" cy="90.5" fill="#ADD1B2" rx="11" ry="11" style="stroke: #000000; stroke-width: 1.0;"/><path d="M92.5938,86.1719 L92.7656,86.25 C92.9844,85.9375 93.1875,85.8438 93.4844,85.8438 C93.7813,85.8438 94.0625,85.9844 94.2188,86.25 C94.3125,86.4063 94.3281,86.5313 94.3281,86.9688 L94.3281,88.3906 C94.3281,88.8125 94.2969,89 94.1875,89.1563 C94.0156,89.375 93.75,89.5156 93.4844,89.5156 C93.2656,89.5156 93.0313,89.4063 92.8906,89.2656 C92.75,89.1406 92.7188,89.0156 92.6563,88.6094 C92.5625,88.2031 92.3906,87.9844 91.9063,87.7031 C91.4375,87.4531 90.8281,87.2969 90.25,87.2969 C88.5156,87.2969 87.2656,88.6094 87.2656,90.3906 L87.2656,91.4844 C87.2656,93.1875 88.5625,94.2813 90.6094,94.2813 C91.375,94.2813 92.0625,94.1563 92.4844,93.8906 C92.6719,93.7969 92.6719,93.7969 93.125,93.3125 C93.3125,93.125 93.5156,93.0469 93.7344,93.0469 C94.2031,93.0469 94.5938,93.4375 94.5938,93.8906 C94.5938,94.2813 94.2656,94.7344 93.6875,95.1406 C92.9375,95.6875 91.7813,95.9844 90.5625,95.9844 C87.6719,95.9844 85.5625,94.0938 85.5625,91.5156 L85.5625,90.3906 C85.5625,87.6719 87.5625,85.5938 90.1875,85.5938 C91.0625,85.5938 91.6563,85.7344 92.5938,86.1719 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="29" x="110.75" y="94.6543">User</text><line style="stroke: #000000; stroke-width: 1.5;" x1="39.5" x2="178.5" y1="106.5" y2="106.5"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="82" x="44.5" y="120.7104">username: str</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="129" x="44.5" y="133.5151">googleSessionId: UUID</text><line style="stroke: #000000; stroke-width: 1.5;" x1="39.5" x2="178.5" y1="140.1094" y2="140.1094"/><!--class Data.Context--><rect fill="#FFFFFF" filter="url(#famtcswlmg5zb)" height="99.2188" id="Data.Context" style="stroke: #000000; stroke-width: 1.5;" width="136" x="258" y="62"/><ellipse cx="298.2" cy="78" fill="#ADD1B2" rx="11" ry="11" style="stroke: #000000; stroke-width: 1.0;"/><path d="M300.5438,73.6719 L300.7156,73.75 C300.9344,73.4375 301.1375,73.3438 301.4344,73.3438 C301.7313,73.3438 302.0125,73.4844 302.1688,73.75 C302.2625,73.9063 302.2781,74.0313 302.2781,74.4688 L302.2781,75.8906 C302.2781,76.3125 302.2469,76.5 302.1375,76.6563 C301.9656,76.875 301.7,77.0156 301.4344,77.0156 C301.2156,77.0156 300.9813,76.9063 300.8406,76.7656 C300.7,76.6406 300.6688,76.5156 300.6063,76.1094 C300.5125,75.7031 300.3406,75.4844 299.8563,75.2031 C299.3875,74.9531 298.7781,74.7969 298.2,74.7969 C296.4656,74.7969 295.2156,76.1094 295.2156,77.8906 L295.2156,78.9844 C295.2156,80.6875 296.5125,81.7813 298.5594,81.7813 C299.325,81.7813 300.0125,81.6563 300.4344,81.3906 C300.6219,81.2969 300.6219,81.2969 301.075,80.8125 C301.2625,80.625 301.4656,80.5469 301.6844,80.5469 C302.1531,80.5469 302.5438,80.9375 302.5438,81.3906 C302.5438,81.7813 302.2156,82.2344 301.6375,82.6406 C300.8875,83.1875 299.7313,83.4844 298.5125,83.4844 C295.6219,83.4844 293.5125,81.5938 293.5125,79.0156 L293.5125,77.8906 C293.5125,75.1719 295.5125,73.0938 298.1375,73.0938 C299.0125,73.0938 299.6063,73.2344 300.5438,73.6719 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="48" x="317.8" y="82.1543">Context</text><line style="stroke: #000000; stroke-width: 1.5;" x1="259" x2="393" y1="94" y2="94"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="109" x="264" y="108.2104">ofUser: Ref&lt;User&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="119" x="264" y="121.0151">timestamp: datetime</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="124" x="264" y="133.8198">params: List[Params]</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="112" x="264" y="146.6245">message: Message</text><line style="stroke: #000000; stroke-width: 1.5;" x1="259" x2="393" y1="153.2188" y2="153.2188"/><!--class Data.Message--><rect fill="#808080" filter="url(#famtcswlmg5zb)" height="66.7422" id="Data.Message" style="stroke: #000000; stroke-width: 1.5;" width="109" x="271.5" y="241"/><ellipse cx="286.5" cy="259.9688" fill="#ADD1B2" rx="11" ry="11" style="stroke: #000000; stroke-width: 1.0;"/><path d="M288.8438,255.6406 L289.0156,255.7188 C289.2344,255.4063 289.4375,255.3125 289.7344,255.3125 C290.0313,255.3125 290.3125,255.4531 290.4688,255.7188 C290.5625,255.875 290.5781,256 290.5781,256.4375 L290.5781,257.8594 C290.5781,258.2813 290.5469,258.4688 290.4375,258.625 C290.2656,258.8438 290,258.9844 289.7344,258.9844 C289.5156,258.9844 289.2813,258.875 289.1406,258.7344 C289,258.6094 288.9688,258.4844 288.9063,258.0781 C288.8125,257.6719 288.6406,257.4531 288.1563,257.1719 C287.6875,256.9219 287.0781,256.7656 286.5,256.7656 C284.7656,256.7656 283.5156,258.0781 283.5156,259.8594 L283.5156,260.9531 C283.5156,262.6563 284.8125,263.75 286.8594,263.75 C287.625,263.75 288.3125,263.625 288.7344,263.3594 C288.9219,263.2656 288.9219,263.2656 289.375,262.7813 C289.5625,262.5938 289.7656,262.5156 289.9844,262.5156 C290.4531,262.5156 290.8438,262.9063 290.8438,263.3594 C290.8438,263.75 290.5156,264.2031 289.9375,264.6094 C289.1875,265.1563 288.0313,265.4531 286.8125,265.4531 C283.9219,265.4531 281.8125,263.5625 281.8125,260.9844 L281.8125,259.8594 C281.8125,257.1406 283.8125,255.0625 286.4375,255.0625 C287.3125,255.0625 287.9063,255.2031 288.8438,255.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="81" x="298.5" y="257.1387">«Embedded»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="56" x="311" y="271.1074">Message</text><line style="stroke: #000000; stroke-width: 1.5;" x1="272.5" x2="379.5" y1="278.9375" y2="278.9375"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="45" x="277.5" y="293.1479">text: str</text><line style="stroke: #000000; stroke-width: 1.5;" x1="272.5" x2="379.5" y1="299.7422" y2="299.7422"/><!--class Data.UserMessage--><rect fill="#808080" filter="url(#famtcswlmg5zb)" height="105.1563" id="Data.UserMessage" style="stroke: #000000; stroke-width: 1.5;" width="117" x="161.5" y="385"/><ellipse cx="176.5" cy="403.9688" fill="#ADD1B2" rx="11" ry="11" style="stroke: #000000; stroke-width: 1.0;"/><path d="M178.8438,399.6406 L179.0156,399.7188 C179.2344,399.4063 179.4375,399.3125 179.7344,399.3125 C180.0313,399.3125 180.3125,399.4531 180.4688,399.7188 C180.5625,399.875 180.5781,400 180.5781,400.4375 L180.5781,401.8594 C180.5781,402.2813 180.5469,402.4688 180.4375,402.625 C180.2656,402.8438 180,402.9844 179.7344,402.9844 C179.5156,402.9844 179.2813,402.875 179.1406,402.7344 C179,402.6094 178.9688,402.4844 178.9063,402.0781 C178.8125,401.6719 178.6406,401.4531 178.1563,401.1719 C177.6875,400.9219 177.0781,400.7656 176.5,400.7656 C174.7656,400.7656 173.5156,402.0781 173.5156,403.8594 L173.5156,404.9531 C173.5156,406.6563 174.8125,407.75 176.8594,407.75 C177.625,407.75 178.3125,407.625 178.7344,407.3594 C178.9219,407.2656 178.9219,407.2656 179.375,406.7813 C179.5625,406.5938 179.7656,406.5156 179.9844,406.5156 C180.4531,406.5156 180.8438,406.9063 180.8438,407.3594 C180.8438,407.75 180.5156,408.2031 179.9375,408.6094 C179.1875,409.1563 178.0313,409.4531 176.8125,409.4531 C173.9219,409.4531 171.8125,407.5625 171.8125,404.9844 L171.8125,403.8594 C171.8125,401.1406 173.8125,399.0625 176.4375,399.0625 C177.3125,399.0625 177.9063,399.2031 178.8438,399.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="81" x="192.5" y="401.1387">«Embedded»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="85" x="190.5" y="415.1074">UserMessage</text><line style="stroke: #000000; stroke-width: 1.5;" x1="162.5" x2="277.5" y1="422.9375" y2="422.9375"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="60" x="167.5" y="437.1479">intent: dict</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="60" x="167.5" y="449.9526">photo: dict</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="85" x="167.5" y="462.7573">sentiment: dict</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="99" x="167.5" y="475.562">google_topic: dict</text><line style="stroke: #000000; stroke-width: 1.5;" x1="162.5" x2="277.5" y1="482.1563" y2="482.1563"/><!--class Data.BotMessage--><rect fill="#808080" filter="url(#famtcswlmg5zb)" height="66.7422" id="Data.BotMessage" style="stroke: #000000; stroke-width: 1.5;" width="131" x="313.5" y="404"/><ellipse cx="338.4" cy="422.9688" fill="#ADD1B2" rx="11" ry="11" style="stroke: #000000; stroke-width: 1.0;"/><path d="M340.7438,418.6406 L340.9156,418.7188 C341.1344,418.4063 341.3375,418.3125 341.6344,418.3125 C341.9313,418.3125 342.2125,418.4531 342.3688,418.7188 C342.4625,418.875 342.4781,419 342.4781,419.4375 L342.4781,420.8594 C342.4781,421.2813 342.4469,421.4688 342.3375,421.625 C342.1656,421.8438 341.9,421.9844 341.6344,421.9844 C341.4156,421.9844 341.1813,421.875 341.0406,421.7344 C340.9,421.6094 340.8688,421.4844 340.8063,421.0781 C340.7125,420.6719 340.5406,420.4531 340.0563,420.1719 C339.5875,419.9219 338.9781,419.7656 338.4,419.7656 C336.6656,419.7656 335.4156,421.0781 335.4156,422.8594 L335.4156,423.9531 C335.4156,425.6563 336.7125,426.75 338.7594,426.75 C339.525,426.75 340.2125,426.625 340.6344,426.3594 C340.8219,426.2656 340.8219,426.2656 341.275,425.7813 C341.4625,425.5938 341.6656,425.5156 341.8844,425.5156 C342.3531,425.5156 342.7438,425.9063 342.7438,426.3594 C342.7438,426.75 342.4156,427.2031 341.8375,427.6094 C341.0875,428.1563 339.9313,428.4531 338.7125,428.4531 C335.8219,428.4531 333.7125,426.5625 333.7125,423.9844 L333.7125,422.8594 C333.7125,420.1406 335.7125,418.0625 338.3375,418.0625 C339.2125,418.0625 339.8063,418.2031 340.7438,418.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="81" x="352.6" y="420.1387">«Embedded»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="77" x="354.6" y="434.1074">BotMessage</text><line style="stroke: #000000; stroke-width: 1.5;" x1="314.5" x2="443.5" y1="441.9375" y2="441.9375"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="119" x="319.5" y="456.1479">fromRule: Ref&lt;Rule&gt;</text><line style="stroke: #000000; stroke-width: 1.5;" x1="314.5" x2="443.5" y1="462.7422" y2="462.7422"/><!--class Data.Params--><rect fill="#808080" filter="url(#famtcswlmg5zb)" height="105.1563" id="Data.Params" style="stroke: #000000; stroke-width: 1.5;" width="127" x="479.5" y="59"/><ellipse cx="502.6" cy="77.9688" fill="#ADD1B2" rx="11" ry="11" style="stroke: #000000; stroke-width: 1.0;"/><path d="M504.9438,73.6406 L505.1156,73.7188 C505.3344,73.4063 505.5375,73.3125 505.8344,73.3125 C506.1313,73.3125 506.4125,73.4531 506.5688,73.7188 C506.6625,73.875 506.6781,74 506.6781,74.4375 L506.6781,75.8594 C506.6781,76.2813 506.6469,76.4688 506.5375,76.625 C506.3656,76.8438 506.1,76.9844 505.8344,76.9844 C505.6156,76.9844 505.3813,76.875 505.2406,76.7344 C505.1,76.6094 505.0688,76.4844 505.0063,76.0781 C504.9125,75.6719 504.7406,75.4531 504.2563,75.1719 C503.7875,74.9219 503.1781,74.7656 502.6,74.7656 C500.8656,74.7656 499.6156,76.0781 499.6156,77.8594 L499.6156,78.9531 C499.6156,80.6563 500.9125,81.75 502.9594,81.75 C503.725,81.75 504.4125,81.625 504.8344,81.3594 C505.0219,81.2656 505.0219,81.2656 505.475,80.7813 C505.6625,80.5938 505.8656,80.5156 506.0844,80.5156 C506.5531,80.5156 506.9438,80.9063 506.9438,81.3594 C506.9438,81.75 506.6156,82.2031 506.0375,82.6094 C505.2875,83.1563 504.1313,83.4531 502.9125,83.4531 C500.0219,83.4531 497.9125,81.5625 497.9125,78.9844 L497.9125,77.8594 C497.9125,75.1406 499.9125,73.0625 502.5375,73.0625 C503.4125,73.0625 504.0063,73.2031 504.9438,73.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="81" x="516.4" y="75.1387">«Embedded»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="47" x="533.4" y="89.1074">Params</text><line style="stroke: #000000; stroke-width: 1.5;" x1="480.5" x2="605.5" y1="96.9375" y2="96.9375"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="115" x="485.5" y="111.1479">ofTopic: Ref&lt;Topic&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="65" x="485.5" y="123.9526">values: dict</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="113" x="485.5" y="136.7573">startTime: datetime</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="62" x="485.5" y="149.562">priority: int</text><line style="stroke: #000000; stroke-width: 1.5;" x1="480.5" x2="605.5" y1="156.1563" y2="156.1563"/><!--link Data.Message to Data.UserMessage--><path d="M293.431,324.968 C280.908,343.989 266.589,365.738 253.94,384.95 " fill="none" id="Data.Message-Data.UserMessage" style="stroke: #808080; stroke-width: 1.0;"/><polygon fill="none" points="287.705,320.936,304.549,308.081,299.398,328.635,287.705,320.936" style="stroke: #808080; stroke-width: 1.0;"/><!--link Data.Message to Data.BotMessage--><path d="M343.001,327.145 C351.303,352.364 361.039,381.938 368.291,403.968 " fill="none" id="Data.Message-Data.BotMessage" style="stroke: #808080; stroke-width: 1.0;"/><polygon fill="none" points="336.33,329.267,336.725,308.081,349.628,324.889,336.33,329.267" style="stroke: #808080; stroke-width: 1.0;"/><!--link Data.Context to Data.Params--><path d="M394.065,111.5 C416.926,111.5 442.582,111.5 466.074,111.5 " fill="none" id="Data.Context-Data.Params" style="stroke: #808080; stroke-width: 1.0;"/><polygon fill="#808080" points="479.244,111.5,473.244,107.5,467.244,111.5,473.244,115.5,479.244,111.5" style="stroke: #808080; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="412.25" y="104.5669">params</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="401.9471" y="107.7419">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="19" x="452.6895" y="124.3391">1+</text><!--link Data.User to Data.Context--><path d="M192.94,111.5 C214.453,111.5 237.325,111.5 257.928,111.5 " fill="none" id="Data.User-Data.Context" style="stroke: #808080; stroke-width: 1.0;"/><polygon fill="#808080" points="179.754,111.5,185.754,115.5,191.754,111.5,185.754,107.5,179.754,111.5" style="stroke: #808080; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="197.75" y="104.5669">ofUser</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="187.463" y="107.8204">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="19" x="230.9284" y="124.3359">1+</text><!--link Data.Context to Data.Message--><path d="M326,161.242 C326,182.348 326,206.923 326,227.69 " fill="none" id="Data.Context-Data.Message" style="stroke: #808080; stroke-width: 1.0;"/><polygon fill="#808080" points="326,240.712,330,234.712,326,228.712,322,234.712,326,240.712" style="stroke: #808080; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="59" x="327" y="207.0669">message</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="317.4375" y="181.3525">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="317.2375" y="229.9456">1</text><!--link Data.Params to AI.Topic--><path d="M543,164.017 C543,261.363 543,471.116 543,566.715 " fill="none" id="Data.Params-AI.Topic" style="stroke: #808080; stroke-width: 1.0;"/><polygon fill="#808080" points="543,579.964,547,573.964,543,567.964,539,573.964,543,579.964" style="stroke: #808080; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="45" x="544" y="351.0669">ofTopic</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="19" x="522.7234" y="184.1471">0+</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="534.2625" y="568.8678">1</text><!--link Data.BotMessage to AI.Rule--><path d="M379,471.056 C379,496.139 379,531.394 379,560.854 " fill="none" id="Data.BotMessage-AI.Rule" style="stroke: #808080; stroke-width: 1.0;"/><polygon fill="#808080" points="379,573.924,383,567.924,379,561.924,375,567.924,379,573.924" style="stroke: #808080; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="370.2625" y="490.7286">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="19" x="358.4859" y="562.9079">0+</text><!--link AI.Rule to AI.Topic--><path d="M437.937,617 C455.754,617 475.153,617 492.376,617 " fill="none" id="AI.Rule-AI.Topic" style="stroke: #808080; stroke-width: 1.0;"/><polygon fill="#808080" points="424.683,617,430.683,621,436.683,617,430.683,613,424.683,617" style="stroke: #808080; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="31" x="443" y="610.0669">rules</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="19" x="432.4431" y="630.1018">0+</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="476.3531" y="613.0038">1</text><!--link AI.Rule to AI.Action--><path d="M383.944,660.146 C386.195,679.337 388.91,702.483 391.411,723.805 " fill="none" id="AI.Rule-AI.Action" style="stroke: #808080; stroke-width: 1.0;"/><polygon fill="#808080" points="392.935,736.793,396.2082,730.3676,391.5359,724.8748,388.2627,731.3003,392.935,736.793" style="stroke: #808080; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="390" y="703.0669">action</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="376.1004" y="680.5778">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="383.5825" y="725.768">1</text><!--
@startuml
skinparam class {
	BackgroundColor White
	ArrowColor Grey
	BorderColor Black
 	BackgroundColor<<Embedded>> Grey
        BorderColor<<Embedded>> Black
}


namespace AI {
    class Topic {
        name: str
        rules: List[Rule]
    }

    class Rule {
        condition: dict
        score: int
        action: Action
    }

    class Action <<Embedded>> {
        text: List[str]
        operations: List[dict]
        isQuestion: bool
        immediatlyNext: bool
    }
}

namespace Data{
    class User {
         username: str
         googleSessionId: UUID
    }

    class Context {
         ofUser: Ref<User>
         timestamp: datetime
         params: List[Params]
         message: Message
    }

    class Message <<Embedded >> {
        text: str
    }

    class UserMessage <<Embedded>> {
         intent: dict
         photo: dict
         sentiment: dict
         google_topic: dict
    }

    class BotMessage <<Embedded>> {
        fromRule: Ref<Rule>
    }

    class Params <<Embedded>>{
        ofTopic: Ref<Topic>
        values: dict
        startTime: datetime
        priority: int
    }
}

Data.UserMessage -up-|> Data.Message
Data.BotMessage -up-|> Data.Message

Data.Context "1" -left-* "1+"  Data.Params : params
Data.Context "1+" -right-* "1"  Data.User : ofUser
Data.Context "1" - -* "1"  Data.Message : message

Data.Params "0+" - -* "1" AI.Topic: ofTopic

Data.BotMessage "1" - -* "0+" AI.Rule
AI.Topic "1" -right-* "0+" AI.Rule : rules

AI.Rule "1" - -* "1" AI.Action : action
@enduml

PlantUML version 1.2018.11(Sat Sep 22 16:43:53 UTC 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.7.0_25-b15
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>